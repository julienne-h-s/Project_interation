<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Speech Command Recognition</title>
    <style>
        body {
            background: #eef2f7;
            font-family: Arial, sans-serif;
            padding: 40px;
            text-align: center;
        }
        .container {
            width: 500px;
            margin: auto;
            padding: 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }
        td, th {
            padding: 8px;
            border-bottom: 1px solid #ccc;
        }
        .highlight {
            background: #e6f1ff;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>üé§ Speech Command Recognition</h2>

    <input type="file" id="audioFile" accept=".wav">
    <button onclick="sendAudio()" style="margin-top:15px;padding:10px;width:100%;">–†–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É</button>

    <div id="result" style="margin-top:20px;font-size:18px;"></div>

    <div id="details"></div>
</div>

<script>
async function sendAudio() {
    const fileInput = document.getElementById("audioFile");
    const resultDiv = document.getElementById("result");
    const detailsDiv = document.getElementById("details");

    if (!fileInput.files.length) {
        resultDiv.innerHTML = "‚ùó –í–∏–±–µ—Ä—ñ—Ç—å WAV-—Ñ–∞–π–ª!";
        return;
    }

    resultDiv.innerHTML = "‚è≥ –û–±—Ä–æ–±–∫–∞...";
    detailsDiv.innerHTML = "";

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    const response = await fetch("/predict", { method: "POST", body: formData });

    const data = await response.json();

    if (data.error) {
        resultDiv.innerHTML = "‚ùå –ü–æ–º–∏–ª–∫–∞!";
        return;
    }

    // –û—Å–Ω–æ–≤–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    resultDiv.innerHTML = `
        <b>–†–æ–∑–ø—ñ–∑–Ω–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞:</b> ${data.command}<br>
        <b>–í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å –º–æ–¥–µ–ª—ñ:</b> ${data.confidence.toFixed(2)}%<br>
        <b>Latency:</b> ${data.latency_ms} ms
    `;

    // –¢–∞–±–ª–∏—Ü—è –∑ —É—Å—ñ–º–∞ –∫–ª–∞—Å–∞–º–∏
    let table = `
        <h3>üìä –î–µ—Ç–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª–∞—Å–∞—Ö</h3>
        <table>
            <tr><th>–ö–æ–º–∞–Ω–¥–∞</th><th>–ô–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å</th></tr>
    `;

    for (const [cls, prob] of Object.entries(data.per_class)) {
        const highlight = cls === data.command ? "class='highlight'" : "";
        table += `<tr ${highlight}><td>${cls}</td><td>${prob.toFixed(2)}%</td></tr>`;
    }

    table += "</table>";

    detailsDiv.innerHTML = table;
}
</script>

</body>
</html>
